<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Code Sphere</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <link rel="stylesheet" href="css/animate.min.css">
      <link rel="stylesheet" href="css/font-awesome.min.css">
      <link rel="stylesheet" href="css/jquery-ui.css">
      <link rel="stylesheet" href="css/jquery.fancybox.min.css">
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <link rel="stylesheet" href="css/meanmenu.css">
      <link rel="stylesheet" href="css/nice-select.css">
      <link rel="stylesheet" href="css/normalize.css">
      <link rel="stylesheet" href="css/owl.carousel.min.css">
      <link rel="stylesheet" href="css/slick.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

      <style>
         .profile-avatar {
           width: 40px;
           height: 40px;
           border-radius: 50%;
           object-fit: cover;
           border: 2px solid #ccc;
           margin-left: 15px;
         }
         .navdiv{
            display:flex;
            flex-wrap: wrap;
         }
         .menu-area{
            margin-top: 5px;
         }
         .navdiv {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.menu-area-main {
    display: flex;
    align-items: center;
    margin: 0;
    padding: 0;
    list-style: none;
}

.profile-container {
    margin-left: auto; /* This pushes the profile to the right */
    padding-left: 20px; /* Adds some spacing between nav items and profile */
}

.profile-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Adjust the search icon spacing */
.mean-last {
    margin-right: 15px;
}
/* Slide-in modal styles */
.profile-modal {
  position: fixed;
  top: 0;
  right: -400px;
  width: 380px;
  height: 100%;
  background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
  box-shadow: -5px 0 25px rgba(0,0,0,0.2);
  transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  z-index: 1000;
  padding: 30px;
  overflow-y: auto;
  border-left: 1px solid rgba(255,255,255,0.3);
}

.profile-modal.show {
  right: 0;
}

.profile-modal-content {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.close-btn {
  align-self: flex-end;
  font-size: 28px;
  cursor: pointer;
  color: #555;
  transition: transform 0.2s;
  margin-bottom: 20px;
}

.close-btn:hover {
  transform: scale(1.2);
  color: #333;
}

.profile-header {
  text-align: center;
  margin-bottom: 30px;
}

.profile-header h2 {
  color: #2c3e50;
  font-size: 24px;
  margin-bottom: 5px;
  font-weight: 600;
}

.modal-avatar-container {
  position: relative;
  width: 120px;
  height: 120px;
  margin: 0 auto 0px;
}

.modal-avatar {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid white;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.modal-avatar:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.upload-container {
  text-align: center;
  margin-bottom: 5px;
}

.upload-btn {
  display: inline-block;
  padding: 8px 20px;
  background-color: #3498db;
  color: white;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 14px;
  border: none;
  margin-top: 10px;
}

.upload-btn:hover {
  background-color: #2980b9;
  transform: translateY(-2px);
}
#upload-Btn{
   display: inline-block;
  padding: 8px 20px;
  background-color:rgb(3, 174, 3);
  color: white;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 14px;
  border: none;
  margin-top: 10px;
}
#upload-Btn:hover{
   background-color: rgb(7, 134, 7);
  transform: translateY(-2px);
}
.profile-section {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.profile-section label {
  display: block;
  margin-bottom: 8px;
  color: #555;
  font-weight: 500;
}

.profile-section input[type="text"] {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  transition: border-color 0.3s;
}

.profile-section input[type="text"]:focus {
  border-color: #3498db;
  outline: none;
  box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
}

.save-btn {
  width: 100%;
  padding: 12px;
  background-color: #2ecc71;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 500;
  transition: all 0.3s;
  margin-top: 15px;
}

.save-btn:hover {
  background-color: #27ae60;
  transform: translateY(-2px);
}

.profile-links {
  margin-top: auto;
  padding-top: 20px;
}

.profile-links a {
  display: flex;
  align-items: center;
  padding: 12px 15px;
  color: #555;
  text-decoration: none;
  border-radius: 6px;
  transition: all 0.3s;
  margin-bottom: 8px;
  background: white;
}

.profile-links a:hover {
  background-color: #f8f9fa;
  color: #3498db;
  transform: translateX(5px);
}

.profile-links a::before {
  content: "→";
  margin-right: 10px;
  color: #3498db;
  transition: all 0.3s;
}

.profile-links a:hover::before {
  transform: translateX(3px);
}

/* Animation for modal entry */
@keyframes modalEntry {
  from { right: -400px; opacity: 0; }
  to { right: 0; opacity: 1; }
}

.profile-modal.show {
  animation: modalEntry 0.4s forwards;
}
.name-display{
   margin-top: 8px;
}


       </style>
       
      
      <!-- Tweaks for older IEs-->
      <!-- [if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif] -->
   </head>
   <!-- body -->
   <body class="main-layout home_page">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="images/loading.gif" alt="#" /></div>
      </div>
      <!-- end loader -->
      <!-- header -->
      <header>
         <div class="header">
            <div class="container">
               <div class="row align-items-center">
                  <!-- LOGO SECTION -->
                  <div class="col-xl-2 col-lg-2 col-md-3 col-sm-3 col logo_section">
                     <div class="full">
                        <div class="center-desk">
                           <div class="logo">
                              <a href="index.html">
                                 <img src="images/codesphere_crp.png" alt="" style="max-width: 90px; height: auto;">
                              </a>
                           </div>
                        </div>
                     </div>
                  </div>
      
                  <!-- MENU SECTION -->
                  <div class="col-xl-10 col-lg-10 col-md-9 col-sm-9 d-flex justify-content-end">
                     <div class="menu-area">
                        <div class="limit-box">
                           <nav class="main-menu">
                              <div class="navdiv d-flex align-items-center">
                                 <ul class="menu-area-main d-flex me-3">
                                    <li class="active"> <a href="index.html">Home</a> </li>
                                    <li> <a href="about.html">About us</a> </li>
                                    <li><a href="books.html">Our Books</a></li>
                                    <li><a href="library.html">Library</a></li>
                                    <li><a href="contact.html">Contact us</a></li>
                                    <li class="mean-last"> <a href="#"><img src="images/search_icon.png" alt="#" /></a> </li>
                                 </ul>
      
                                 <!-- Profile Image on Right -->
                                 <div class="profile-container">
                                    <img id="profilePicture" alt="Profile Picture" class="profile-avatar" style="width: 40px; height: 40px; border-radius: 50%;">
                                 </div>
                              </div>
                           </nav>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </header>
      
      <!-- end header -->
      <section class="slider_section">
         <div id="myCarousel" class="carousel slide banner-main" data-ride="carousel">
            <div class="carousel-inner">
               <div class="carousel-item active">
                  <img class="first-slide" src="images/banner.jpg" alt="First slide">
                  <div class="container">
                     <div class="carousel-caption relative">
                        <h1>The Best Libraries That<br> Every Book Lover Must<br> Visit!</h1>
                        <p>Reading books expands the mind, transports us to new worlds, and deepens our understanding of life.<br>  </p>
                        <div class="button_section"> <a class="main_bt" href="#">Read More</a>  </div>
                        <ul class="locat_icon">
                           <li> <a href="#"><img src="icon/facebook.png"></a></li>
                           <li> <a href="#"><img src="icon/Twitter.png"></a></li>
                           <li> <a href="#"><img src="icon/linkedin.png"></a></li>
                           <li> <a href="#"><img src="icon/instagram.png"></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="carousel-item">
                  <img class="second-slide" src="images/banner.jpg" alt="Second slide">
                  <div class="container">
                     <div class="carousel-caption relative">
                        <h1>The Best Libraries That<br> Every Book Lover Must<br> Visit!</h1>
                        <p>"Read,Return,Repeat:Rent a book today and discover a new World!"<br> <br> </p>
                        <div class="button_section"> <a class="main_bt" href="#">Read More</a>  </div>
                        <ul class="locat_icon">
                           <li> <a href="#"><img src="icon/facebook.png"></a></li>
                           <li> <a href="#"><img src="icon/Twitter.png"></a></li>
                           <li> <a href="#"><img src="icon/linkedin.png"></a></li>
                           <li> <a href="#"><img src="icon/instagram.png"></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="carousel-item">
                  <img class="third-slide" src="images/banner.jpg" alt="Third slide">
                  <div class="container">
                     <div class="carousel-caption relative">
                        <h1>The Best Libraries That<br> Every Book Lover Must<br> Visit!</h1>
                        <p>"Unlimited Stories,limited budget?Rent a book and read on!"<br> <br> </p>
                        <div class="button_section"> <a class="main_bt" href="#">Read More</a>  </div>
                        <ul class="locat_icon">
                           <li> <a href="#"><img src="icon/facebook.png"></a></li>
                           <li> <a href="#"><img src="icon/Twitter.png"></a></li>
                           <li> <a href="#"><img src="icon/linkedin.png"></a></li>
                           <li> <a href="#"><img src="icon/instagram.png"></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
            <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
            </a>
         </div>
      </section>
      <!-- about -->
      <div class="about">
         <div class="container">
            <div class="row">
               <div class="col-md-10 offset-md-1">
                  <div class="aboutheading">
                     <h2>About <strong class="black">Us</strong></h2>
                     <span>Welcome to CODESPHERE, your trusted destination for book renting! We believe that everyone should have access to a vast collection of books without the need to buy and store them. Our mission is to make reading affordable, convenient, and sustainable by offering a diverse range of books for rent—from bestsellers and classics to academic and self-improvement titles.</span>
                  </div>
               </div>
            </div>
            <div class="row border">
               <div class="col-xl-7 col-lg-7 col-md-12 col-sm-12">
                  <div class="about-box">
                     <p> Whether you’re a student, an avid reader, or someone looking for a one-time read, our flexible rental plans ensure you get the books you love at a fraction of the cost. With easy online browsing, doorstep delivery, and hassle-free returns, we make book renting simple and enjoyable.

                        Join our community of readers today and embark on endless literary adventures without the clutter!</p>
                     <a href="#">Read More</a>
                  </div>
               </div>
               <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12">
                  <div class="about-box">
                     <figure><img src="images/about.png" alt="img" /></figure>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- end about -->
      <!-- Library -->
      <div class="Library">
         <div class="container">
            <div class="row">
               <div class="col-md-10 offset-md-1">
                  <div class="titlepage">
                     <h2>Our <strong class="black">Library </strong></h2>
                     <span>The books in our library offer a vast collection of knowledge, adventure, and inspiration, catering to readers of all ages and interests.</span> 
                  </div>
               </div>
            </div>
         </div>
         <div class="bg">
            <div class="container">
               <div class="row">
                  <div class="col-md-10 offset-md-1">
                     <div class="Library-box">
                        <figure><img src="images/Library-.jpg" alt="#"/></figure>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="container">
            <div class="row">
               <div class="col-md-12">
                  <div class="read-more">
                     <a href="#">Read More</a>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- end Library -->
      <!--Books -->
      <div class="Books">
         <div class="container">
            <div class="row">
               <div class="col-md-10 offset-md-1">
                  <div class="titlepage">
                     <h2>Our <strong class="black">Books </strong></h2>
                     <span>Our books are a treasure trove of knowledge, imagination, and discovery, enriching minds and inspiring curiosity.</span> 
                  </div>
               </div>
            </div>
            <div class="row box">
               <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                  <div class="book-box">
                     <figure><img src="images/book-1.jpg" alt="img"/></figure>
                  </div>
               </div>
               <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                  <div class="book-box">
                     <figure><img src="images/book-2.jpg" alt="img"/></figure>
                  </div>
               </div>
               <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                  <div class="book-box">
                     <figure><img src="images/book-1.jpg" alt="img"/></figure>
                  </div>
               </div>
               <div class="col-md-6 offset-md-3">
                  <p>"Reading is essential for those who seek to rise above the ordinary." – Jim Rohn</p>
               </div>
            </div>
            <div class="container">
               <div class="row">
                  <div class="col-md-12">
                     <div class="read-more">
                        <a href="#">Read More</a>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- end Books -->
      <!-- Contact -->
      <div class="Contact">
         <div class="container">
            <div class="row">
               <div class="col-md-12">
                  <div class="titlepage3">
                     <h2>Contact</h2>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                  <form>
                     <div class="row">
                        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                           <input class="form-control" placeholder="Name" type="Name">
                        </div>
                        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                           <input class="form-control" placeholder="Phone Number" type="Phone Number">
                        </div>
                        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                           <input class="form-control" placeholder="Email" type="Email">
                        </div>
                        <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                           <textarea class="textarea" placeholder="Message">Message</textarea>
                        </div>
                     </div>
                  </form>
               </div>
               <button class="send-btn">Send</button>
            </div>
         </div>
      </div>
      <div id="profileModal" class="profile-modal">
         <div class="profile-modal-content">
           <span class="close-btn" onclick="toggleProfileModal()">&times;</span>
           
           <div class="profile-header">
             <h2>My Profile</h2>
             <p>Manage your account settings</p>
           </div>
           
           <div class="modal-avatar-container">
             <img id="modalProfilePic" class="modal-avatar" src="" alt="Profile Picture">
           </div>
           <div class="name-display" style="text-align: center; margin-top: 1rem;">
            <span id="displayUsername" style="font-size: 1.1rem; font-weight: bold;"></span>
          </div>
           
           <div class="upload-container">
             <label for="uploadNewPic" class="upload-btn">Change Profile Picture</label>
             <input type="file" id="uploadNewPic" accept="image/*" style="display: none;">
           </div>
           <div class="upload-section" style="text-align: center; margin-top: 0rem;">
            <input type="file" id="profileImageInput" accept="image/*" style="display: none;" />
            <button id="upload-Btn">Update Profile Picture</button>
          </div>
          
          
           
           
           <div class="profile-links">
             <a href="my-rentals.html">
               <i class="fas fa-book"></i> My Rentals
             </a>
             <a href="#" onclick="logoutUser()">
               <i class="fas fa-sign-out-alt"></i> Logout
             </a>
             <a href="#" onclick="deleteAccount()" style="color: red;">
               <i class="fas fa-user-times"></i> Delete Account
             </a>
             
           </div>
         </div>
       </div>
      <!-- end Contact -->
      <!-- footer -->
      <footer>
         <div class="footer">
            <div class="container">
               <div class="row pdn-top-30">
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                     <div class="Follow">
                        <h3>Follow Us</h3>
                     </div>
                     <ul class="location_icon">
                        <li> <a href="#"><img src="icon/facebook.png"></a></li>
                        <li> <a href="#"><img src="icon/Twitter.png"></a></li>
                        <li> <a href="#"><img src="icon/linkedin.png"></a></li>
                        <li> <a href="#"><img src="icon/instagram.png"></a></li>
                     </ul>
                  </div>
                  <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12">
                     <div class="Follow">
                        <h3>Newsletter</h3>
                     </div>
                     <input class="Newsletter" placeholder="Enter your email" type="Enter your email">
                     <button class="Subscribe">Subscribe</button>
                  </div>
               </div>
            </div>
         </div>
         <div class="copyright">
            <div class="container">
               <p>&copy; 2025 codesphere   <a href="https://html.design/"></a></p>
            </div>
         </div>
      </footer>

      <script>
         document.addEventListener('DOMContentLoaded', async () => {
    const token = sessionStorage.getItem("token");
    if (!token) return;

    try {
        const response = await fetch("http://localhost:5000/user/profile-picture", {
            headers: { "Authorization": `Bearer ${token}` }
        });

        const result = await response.json();

        if (response.ok && result.success) {
            const profileImg = document.getElementById("profilePicture");
            if (profileImg) {
                profileImg.src = result.profileImageUrl;
                profileImg.alt = "Your Profile Picture";
                profileImg.style.display = "block";
            }
        } else {
            console.warn("No profile image found or error occurred.");
        }
    } catch (err) {
        console.error("Error loading profile image:", err);
    }
});
  const profileImage = document.getElementById("profilePicture");
  const profileModal = document.getElementById("profileModal");
  const modalProfilePic = document.getElementById("modalProfilePic");

  function toggleProfileModal() {
    profileModal.classList.toggle("show");
  }

  profileImage.addEventListener("click", async () => {
    toggleProfileModal();

    // Load current profile pic inside modal
    modalProfilePic.src = profileImage.src;

    // Optional: Fetch name from backend and prefill
    const token = sessionStorage.getItem("token");
    try {
      const res = await fetch("http://localhost:5000/user/details", {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      document.getElementById("displayUsername").textContent = data.name || "";

    } catch (err) {
      console.error("Failed to fetch user name:", err);
    }
  });

  async function uploadNewProfilePicture() {
    const fileInput = document.getElementById("uploadNewPic");
    const file = fileInput.files[0];
    if (!file) return alert("Select an image");

    const formData = new FormData();
    formData.append("profileImage", file);

    const token = sessionStorage.getItem("token");
    try {
      const response = await fetch("http://localhost:5000/upload-profile-picture", {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` },
        body: formData,
      });

      const result = await response.json();
      if (result.success) {
        alert("Profile picture updated!");
        const imageUrl = `http://localhost:5000/uploads/profile_pictures/${result.profileImage}`;
        profileImage.src = result.profileImageUrl;
        modalProfilePic.src = result.profileImageUrl;
      } else {
        alert("Failed to update profile picture.");
      }
    } catch (err) {
      console.error("Upload failed:", err);
      alert("Something went wrong.");
    }
  }


  function logoutUser() {
    sessionStorage.removeItem("token");
    window.location.href = "login.html";
  }
// Add this to your existing JavaScript
function toggleProfileModal() {
  profileModal.classList.toggle("show");
  document.body.style.overflow = profileModal.classList.contains("show") ? "hidden" : "auto";
}

// Close modal when clicking outside
document.addEventListener('click', (e) => {
  if (profileModal.classList.contains('show') && 
      !e.target.closest('.profile-modal') && 
      !e.target.closest('.profile-container')) {
    toggleProfileModal();
  }
});

// Add Font Awesome for icons (add this to your head)

// Enhanced upload function with preview
document.getElementById('uploadNewPic').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      modalProfilePic.src = event.target.result;
      modalProfilePic.classList.add('uploading');
      setTimeout(() => {
        modalProfilePic.classList.remove('uploading');
      }, 500);
    }
    reader.readAsDataURL(file);
  }
});
async function deleteAccount() {
  const confirmDelete = confirm("Are you sure you want to delete your account? This action cannot be undone.");
  if (!confirmDelete) return;

  const token = sessionStorage.getItem("token");
  try {
    const res = await fetch("http://localhost:5000/delete-account", {
      method: "DELETE",
      headers: {
        Authorization: `Bearer ${token}`
      }
    });

    const result = await res.json();
    if (res.ok && result.success) {
      alert("Your account has been deleted.");
      sessionStorage.removeItem("token");
      window.location.href = "login.html"; // Or redirect to home/login
    } else {
      alert(result.message || "Failed to delete account.");
    }
  } catch (err) {
    console.error("Error deleting account:", err);
    alert("An error occurred while deleting your account.");
  }
}

document.getElementById("upload-Btn").addEventListener("click", uploadNewProfilePicture);



     </script>
     
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <script src="js/plugin.js"></script>
      <!-- sidebar -->
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
      <!-- Slide-in Profile Modal -->

 
   </body>
</html>